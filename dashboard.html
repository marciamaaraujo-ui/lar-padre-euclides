<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard ILPI</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<!-- ================= NAVBAR ================= -->
<div class="navbar">
  <div class="nav-container">

    <div class="nav-left">
      <img src="assets/logo.png" class="nav-logo">

      <div id="pacienteAtivoInfo" class="paciente-ativo">
        ğŸ‘¤ Nenhum paciente selecionado
      </div>
    </div>

    <div class="nav-links">
      <a href="index.html">ğŸ  InÃ­cio</a>
      <a href="ficha-completa.html">ğŸ“‹ AvaliaÃ§Ã£o Completa</a>
      <a href="exames-laboratoriais.html">ğŸ§ª Exames</a>
      <a href="comorbidades.html">ğŸ¥ Comorbidades</a>
      <a href="dashboard.html">ğŸ“Š Dashboard</a>
      <a href="metodologia.html">ğŸ“˜ Metodologia</a>

      <div id="indicadorRisco" class="indicador-risco neutro">
        ICN: â€”
      </div>

      <button class="btn-navbar" onclick="salvarRegistro()">ğŸ’¾ Salvar</button>
    </div>

  </div>
</div>

<!-- ================= CONTEÃšDO ================= -->
<div class="container">

<h1>Painel EpidemiolÃ³gico</h1>

<section style="margin-top:40px;">
<h3>Top 5 Comorbidades</h3>
<canvas id="graficoComorb"></canvas>
</section>

</div>

<!-- ================= APP GLOBAL ================= -->
<script src="app.js"></script>

<!-- ================= SCRIPT DASHBOARD ================= -->
<script>

document.addEventListener("DOMContentLoaded", function(){

    atualizarPacienteAtivoNavbar();
    renderizarDashboard();

});

function renderizarDashboard(){

    const banco = obterBanco();
    let contagem = {};

    Object.keys(banco).forEach(nome => {

        if(!banco[nome].comorbidades) return;

        banco[nome].comorbidades.forEach(c => {
            contagem[c] = (contagem[c] || 0) + 1;
        });
    });

    const top = Object.entries(contagem)
        .sort((a,b) => b[1] - a[1])
        .slice(0,5);

    const ctx = document.getElementById("graficoComorb");

    if(!ctx) return;

    if(top.length === 0){
        ctx.parentElement.innerHTML += "<p style='margin-top:15px;'>Nenhum dado disponÃ­vel.</p>";
        return;
    }

    new Chart(ctx,{
        type:"bar",
        data:{
            labels: top.map(i => i[0]),
            datasets:[{
                label:"NÂº de Residentes",
                data: top.map(i => i[1]),
                backgroundColor:"#22c55e"
            }]
        },
        options:{
            responsive:true,
            plugins:{
                legend:{ display:false }
            },
            scales:{
                y:{
                    beginAtZero:true,
                    ticks:{ stepSize:1 }
                }
            }
        }
    });

}
</script>

</body>
</html>
