<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exames Laboratoriais - ILPI</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<style>
/* (mantÃ©m seu CSS interno aqui sem alterar) */
</style>

</head>

<body>

<!-- NAVBAR INSTITUCIONAL -->
<div class="navbar">
  <div class="nav-container">

    <div class="nav-left">
      <img src="assets/logo.png" class="nav-logo" alt="Logo ILPI">
    </div>

    <div class="nav-links">
      <a href="index.html">ğŸ  InÃ­cio</a>
      <a href="ficha-completa.html">ğŸ“‹ AvaliaÃ§Ã£o Completa</a>
      <a href="exames-laboratoriais.html">ğŸ§ª Exames</a>
      <a href="comorbidades.html">ğŸ¥ Comorbidades</a>
      <a href="dashboard.html">ğŸ“Š Dashboard</a>
      <a href="metodologia.html">ğŸ“˜ Metodologia</a>

      <div id="indicadorRisco" class="indicador-risco neutro">
        ICN: â€”
      </div>

      <button class="btn-navbar" onclick="salvarRegistro()">ğŸ’¾ Salvar</button>
    </div>

  </div>
</div>

<div class="container">

<h1>Painel Laboratorial Integrado</h1>

<select id="selectResidente" onchange="analisar()" style="margin-bottom:20px;"></select>

<table class="tabela-exames">
<thead>
<tr>
<th>Marcador</th>
<th>Resultado</th>
<th>ReferÃªncia</th>
<th>Status</th>
<th>InterpretaÃ§Ã£o</th>
</tr>
</thead>
<tbody id="corpoTabela"></tbody>
</table>

<h3>Laudo ClÃ­nico Nutricional Integrado</h3>
<textarea id="relatorioAutomatico" rows="16"></textarea>

</div>

<script>

/* ================= BASE COMPLETA ================= */

const exames = [
{nome:"Hemoglobina", ref:[12,17.5], alto:"Policitemia.", baixo:"Anemia."},
{nome:"VCM", ref:[80,100], alto:"Macrocitose.", baixo:"Microcitose."},
{nome:"RDW", ref:[11.5,14.5], alto:"Anisocitose.", baixo:"Sem relevÃ¢ncia isolada."},
{nome:"LeucÃ³citos", ref:[4000,11000], alto:"InfecÃ§Ã£o/inflamaÃ§Ã£o.", baixo:"ImunossupressÃ£o."},
{nome:"NeutrÃ³filos", ref:[45,70], alto:"InfecÃ§Ã£o bacteriana.", baixo:"Risco infeccioso."},
{nome:"EosinÃ³filos", ref:[1,4], alto:"Alergia/parasitose.", baixo:"Estresse agudo."},
{nome:"Plaquetas", ref:[150000,450000], alto:"InflamaÃ§Ã£o ativa.", baixo:"Risco hemorrÃ¡gico."},
{nome:"Glicemia Jejum", ref:[70,99], alto:"Hiperglicemia.", baixo:"Hipoglicemia."},
{nome:"HbA1c", ref:[0,5.7], alto:"Descontrole glicÃªmico.", baixo:"PossÃ­vel interferÃªncia."},
{nome:"Albumina", ref:[3.5,5.0], alto:"DesidrataÃ§Ã£o.", baixo:"DesnutriÃ§Ã£o/inflamaÃ§Ã£o."},
{nome:"PCR", ref:[0,0.3], alto:"InflamaÃ§Ã£o sistÃªmica.", baixo:"Normal."},
{nome:"Ureia", ref:[10,50], alto:"DisfunÃ§Ã£o renal.", baixo:"Hipoproteica."},
{nome:"Creatinina", ref:[0.6,1.3], alto:"DisfunÃ§Ã£o renal.", baixo:"Sarcopenia."},
{nome:"Colesterol Total", ref:[0,190], alto:"Risco cardiovascular.", baixo:"MÃ¡ absorÃ§Ã£o."},
{nome:"HDL", ref:[40,999], alto:"Protetor.", baixo:"Risco CV."},
{nome:"LDL", ref:[0,130], alto:"Risco aterosclerÃ³tico.", baixo:"DesnutriÃ§Ã£o."},
{nome:"TriglicerÃ­deos", ref:[0,150], alto:"Risco pancreatite.", baixo:"MÃ¡ absorÃ§Ã£o."},
{nome:"Vitamina D", ref:[20,999], alto:"Toxicidade rara.", baixo:"DeficiÃªncia Ã³ssea."},
{nome:"Vitamina B12", ref:[200,900], alto:"Excesso suplementar.", baixo:"DeficiÃªncia."},
{nome:"Ferritina", ref:[13,400], alto:"InflamaÃ§Ã£o fase aguda.", baixo:"DeficiÃªncia ferro."},
{nome:"Ferro SÃ©rico", ref:[60,170], alto:"Sobrecarga ferro.", baixo:"Anemia ferropriva."},
{nome:"Zinco", ref:[70,120], alto:"Excesso suplementar.", baixo:"Baixa imunidade."},
{nome:"PotÃ¡ssio", ref:[3.5,5.1], alto:"Risco cardÃ­aco.", baixo:"Perdas GI."},
{nome:"CÃ¡lcio", ref:[8.5,10.2], alto:"Hiperparatireoidismo.", baixo:"DeficiÃªncia Vit D."},
{nome:"TGO/TGP", ref:[0,40], alto:"LesÃ£o hepÃ¡tica.", baixo:"Sem relevÃ¢ncia."},
{nome:"TSH", ref:[0.45,4.5], alto:"Hipotireoidismo.", baixo:"Hipertireoidismo."}
];

/* ================= MONTAR TABELA ================= */

const tbody = document.getElementById("corpoTabela");

exames.forEach((ex,i)=>{
tbody.innerHTML += `
<tr>
<td>${ex.nome}</td>
<td><input type="number" step="any" id="res_${i}" oninput="analisar()"></td>
<td>${ex.ref[0]} - ${ex.ref[1]}</td>
<td id="status_${i}">-</td>
<td id="interp_${i}">-</td>
</tr>`;
});

/* ================= CARREGAR RESIDENTES ================= */

function carregarResidentes(){
const banco = JSON.parse(localStorage.getItem("bancoILPI")) || {};
const select = document.getElementById("selectResidente");
select.innerHTML='<option value="">Selecionar residente...</option>';
Object.keys(banco).forEach(nome=>{
select.innerHTML+=`<option value="${nome}">${nome}</option>`;
});
}
carregarResidentes();

/* ================= FUNÃ‡ÃƒO PRINCIPAL ================= */

function analisar(){

let r = {};
let alteracoes = 0;
let iri = 0;
let sistemas = 0;

const banco = JSON.parse(localStorage.getItem("bancoILPI")) || {};
const residente = document.getElementById("selectResidente").value;
let comorb = [];

if(residente && banco[residente]?.comorbidades){
comorb = banco[residente].comorbidades;
}

/* ==== AnÃ¡lise individual ==== */

exames.forEach((ex,i)=>{

const val=parseFloat(document.getElementById("res_"+i).value);
const status=document.getElementById("status_"+i);
const interp=document.getElementById("interp_"+i);

if(isNaN(val)){
status.innerText="-";
interp.innerText="-";
status.className="";
return;
}

if(val>ex.ref[1]){
status.innerText="â†‘";
status.className="resultado-alto";
interp.innerText=ex.alto;
r[ex.nome]="â†‘";
alteracoes++;
}
else if(val<ex.ref[0]){
status.innerText="â†“";
status.className="resultado-baixo";
interp.innerText=ex.baixo;
r[ex.nome]="â†“";
alteracoes++;
}
else{
status.innerText="Normal";
status.className="resultado-normal";
interp.innerText="Dentro da normalidade.";
}

});

/* ==== Ãndice InflamatÃ³rio ==== */

if(r["PCR"]==="â†‘") iri+=2;
if(r["Ferritina"]==="â†‘") iri+=1;
if(r["NeutrÃ³filos"]==="â†‘") iri+=1;
if(r["Albumina"]==="â†“") iri+=1;
if(r["Plaquetas"]==="â†‘") iri+=1;

let iriClass="Baixo";
if(iri>=4) iriClass="Alto";
else if(iri>=2) iriClass="Moderado";

/* ==== Cruzamento com comorbidades ==== */

let texto="";

if(comorb.includes("HipertensÃ£o Arterial (HAS)") && r["LDL"]==="â†‘"){
texto+="HAS associada a LDL elevado â†’ Alto risco cardiovascular.\n";
sistemas++;
}

if(comorb.includes("Diabetes Mellitus") && r["HbA1c"]==="â†‘"){
texto+="Diabetes descompensado (HbA1c elevado).\n";
sistemas++;
}

if(comorb.includes("DoenÃ§a Renal CrÃ´nica") && (r["Ureia"]==="â†‘" || r["Creatinina"]==="â†‘")){
texto+="Comprometimento renal ativo.\n";
sistemas++;
}

if(comorb.includes("Obesidade") && r["TriglicerÃ­deos"]==="â†‘"){
texto+="Obesidade associada a hipertrigliceridemia.\n";
sistemas++;
}

/* ==== Score Global ==== */

let gravidade="Baixa";
if(alteracoes>=5 || sistemas>=2) gravidade="Moderada";
if(alteracoes>=8 || sistemas>=3 || iri>=4) gravidade="Alta";

/* ==== DiagnÃ³stico PES ==== */

let pes="Sem diagnÃ³stico nutricional relevante.";

if(r["Albumina"]==="â†“"){
pes="DesnutriÃ§Ã£o proteico-calÃ³rica relacionada a processo inflamatÃ³rio evidenciada por hipoalbuminemia.";
}

if(r["Hemoglobina"]==="â†“"){
pes="Anemia relacionada a deficiÃªncia de micronutrientes evidenciada por hemoglobina reduzida.";
}

if(r["Glicemia Jejum"]==="â†‘"){
pes="Descontrole glicÃªmico relacionado Ã  resistÃªncia insulÃ­nica evidenciado por hiperglicemia.";
}

/* ==== LAUDO FINAL ==== */

let laudo="LAUDO CLÃNICO NUTRICIONAL INTEGRADO\n\n";

if(texto===""){
laudo+="Sem cruzamentos relevantes entre exames e comorbidades.\n\n";
}else{
laudo+=texto+"\n";
}

laudo+="Ãndice InflamatÃ³rio: "+iriClass+" (Score "+iri+")\n";
laudo+="Gravidade Global: "+gravidade+"\n\n";
laudo+="DiagnÃ³stico Nutricional (PES):\n"+pes;

document.getElementById("relatorioAutomatico").value=laudo;

}

</script>

    <script src="app.js"></script>
    
</body>
</html>
