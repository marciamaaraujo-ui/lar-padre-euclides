<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exames Laboratoriais - ILPI</title>
<link rel="stylesheet" href="style.css">

<style>
.tabela-exames { width:100%; border-collapse:collapse; margin-top:20px; font-size:0.85rem;}
.tabela-exames th, .tabela-exames td { border:1px solid #e0e0e0; padding:8px; vertical-align:top;}
.tabela-exames th { background:#f0f4f2; font-weight:bold;}
.resultado-normal { background:#e8f8f5; color:#1e8449; font-weight:bold;}
.resultado-alto { background:#fdecea; color:#c0392b; font-weight:bold;}
.resultado-baixo { background:#fff4e6; color:#d35400; font-weight:bold;}
textarea { width:100%; margin-top:25px; padding:12px; font-size:0.9rem;}
</style>
</head>

<body>

<div class="navbar">
<div class="nav-container">
<img src="assets/logo.png" class="nav-logo">
<div class="nav-links">
<a href="index.html" class="nav-link">ğŸ  Nova AvaliaÃ§Ã£o</a>
<a href="dashboard.html" class="nav-link">ğŸ“Š Dashboard</a>
<a href="ficha-completa.html" class="nav-link">ğŸ“‚ Ficha ClÃ­nica</a>
<a href="exames-laboratoriais.html" class="nav-link home-btn">ğŸ§ª Exames</a>
<a href="comorbidades.html" class="nav-link">ğŸ¥ Comorbidades</a>
<a href="metodologia.html" class="nav-link">ğŸ“˜ Metodologia</a>
</div>
</div>
</div>

<div class="container">
<h1>Painel Laboratorial Institucional</h1>

<select id="selectResidente" style="margin-bottom:20px;"></select>

<table class="tabela-exames">
<thead>
<tr>
<th>Marcador</th>
<th>Resultado</th>
<th>ReferÃªncia</th>
<th>AlteraÃ§Ã£o</th>
<th>InterpretaÃ§Ã£o</th>
</tr>
</thead>
<tbody id="corpoTabela"></tbody>
</table>

<h3>Laudo ClÃ­nico Integrado</h3>
<textarea id="relatorioAutomatico" rows="14"></textarea>

</div>

<script>

/* ================== BASE COMPLETA DE EXAMES ================== */

const exames = [

{nome:"Hemoglobina", ref:[12,17.5], alto:"Policitemia.", baixo:"Anemia."},
{nome:"VCM", ref:[80,100], alto:"Anemia macrocÃ­tica.", baixo:"Anemia microcÃ­tica."},
{nome:"RDW", ref:[11.5,14.5], alto:"Anisocitose.", baixo:"Sem relevÃ¢ncia isolada."},
{nome:"LeucÃ³citos", ref:[4000,11000], alto:"InfecÃ§Ã£o ou inflamaÃ§Ã£o.", baixo:"ImunossupressÃ£o."},
{nome:"NeutrÃ³filos", ref:[45,70], alto:"InfecÃ§Ã£o bacteriana.", baixo:"Risco infeccioso."},
{nome:"EosinÃ³filos", ref:[1,4], alto:"Alergia ou parasitose.", baixo:"Estresse agudo."},
{nome:"Plaquetas", ref:[150000,450000], alto:"InflamaÃ§Ã£o ativa.", baixo:"Risco hemorrÃ¡gico."},

{nome:"Glicemia Jejum", ref:[70,99], alto:"Hiperglicemia.", baixo:"Hipoglicemia."},
{nome:"HbA1c", ref:[0,5.7], alto:"Descontrole glicÃªmico.", baixo:"PossÃ­vel interferÃªncia hematolÃ³gica."},

{nome:"Albumina", ref:[3.5,5.0], alto:"DesidrataÃ§Ã£o.", baixo:"DesnutriÃ§Ã£o ou inflamaÃ§Ã£o."},
{nome:"PCR", ref:[0,0.3], alto:"InflamaÃ§Ã£o sistÃªmica.", baixo:"Normal."},

{nome:"Ureia", ref:[10,50], alto:"DisfunÃ§Ã£o renal ou hiperproteica.", baixo:"Hipoproteica."},
{nome:"Creatinina", ref:[0.6,1.3], alto:"DisfunÃ§Ã£o renal.", baixo:"Sarcopenia."},

{nome:"Colesterol Total", ref:[0,190], alto:"Risco cardiovascular.", baixo:"MÃ¡ absorÃ§Ã£o."},
{nome:"HDL", ref:[40,999], alto:"Protetor cardiovascular.", baixo:"Risco cardiovascular aumentado."},
{nome:"LDL", ref:[0,130], alto:"Risco aterosclerÃ³tico.", baixo:"DesnutriÃ§Ã£o."},
{nome:"TriglicerÃ­deos", ref:[0,150], alto:"Risco pancreatite.", baixo:"MÃ¡ absorÃ§Ã£o."},

{nome:"Vitamina D", ref:[20,999], alto:"Toxicidade rara.", baixo:"DeficiÃªncia Ã³ssea."},
{nome:"Vitamina B12", ref:[200,900], alto:"SuplementaÃ§Ã£o excessiva.", baixo:"DeficiÃªncia."},
{nome:"Ferritina", ref:[13,400], alto:"InflamaÃ§Ã£o (fase aguda).", baixo:"DeficiÃªncia de ferro."},
{nome:"Ferro SÃ©rico", ref:[60,170], alto:"Sobrecarga de ferro.", baixo:"Anemia ferropriva."},
{nome:"Zinco", ref:[70,120], alto:"Excesso de suplementaÃ§Ã£o.", baixo:"Baixa imunidade."},

{nome:"PotÃ¡ssio", ref:[3.5,5.1], alto:"Risco cardÃ­aco.", baixo:"Perdas gastrointestinais."},
{nome:"CÃ¡lcio", ref:[8.5,10.2], alto:"Hiperparatireoidismo.", baixo:"DeficiÃªncia de Vit D."},

{nome:"TGO/TGP", ref:[0,40], alto:"LesÃ£o hepÃ¡tica.", baixo:"Sem relevÃ¢ncia clÃ­nica."},
{nome:"TSH", ref:[0.45,4.5], alto:"Hipotireoidismo.", baixo:"Hipertireoidismo."}

];

/* ================== MONTAR TABELA ================== */

const tbody = document.getElementById("corpoTabela");

exames.forEach((ex,i)=>{
tbody.innerHTML += `
<tr>
<td>${ex.nome}</td>
<td><input type="number" step="any" id="res_${i}" oninput="analisarLinha(${i})"></td>
<td>${ex.ref[0]} - ${ex.ref[1]}</td>
<td id="status_${i}">-</td>
<td id="interp_${i}">-</td>
</tr>`;
});

/* ================== ANÃLISE INDIVIDUAL ================== */

function analisarLinha(i){

const ex = exames[i];
const val = parseFloat(document.getElementById("res_"+i).value);
const status = document.getElementById("status_"+i);
const interp = document.getElementById("interp_"+i);

if(isNaN(val)){
status.innerText="-";
interp.innerText="-";
status.className="";
gerarLaudo();
return;
}

if(val > ex.ref[1]){
status.innerText="â†‘";
status.className="resultado-alto";
interp.innerText=ex.alto;
}
else if(val < ex.ref[0]){
status.innerText="â†“";
status.className="resultado-baixo";
interp.innerText=ex.baixo;
}
else{
status.innerText="Normal";
status.className="resultado-normal";
interp.innerText="Dentro da normalidade.";
}

gerarLaudo();
}

/* ================== GERAÃ‡ÃƒO DE LAUDO ================== */

function gerarLaudo(){

let alteracoes = [];
let iri = 0;

exames.forEach((ex,i)=>{
let status = document.getElementById("status_"+i).innerText;
if(status==="â†‘" || status==="â†“"){
alteracoes.push(ex.nome + " " + status);
}
});

/* Ãndice InflamatÃ³rio */
if(document.getElementById("status_9")?.innerText==="â†‘") iri+=2; // PCR
if(document.getElementById("status_10")?.innerText==="â†“") iri+=1; // Albumina
if(document.getElementById("status_4")?.innerText==="â†‘") iri+=1; // NeutrÃ³filos

let iriClass="Baixo";
if(iri>=3) iriClass="Alto";
else if(iri>=2) iriClass="Moderado";

/* Score Gravidade */
let gravidade="Baixa";
if(alteracoes.length>=5) gravidade="Moderada";
if(alteracoes.length>=8) gravidade="Alta";

/* Laudo */
let laudo="LAUDO LABORATORIAL INTEGRADO\n\n";

if(alteracoes.length===0){
laudo+="Sem alteraÃ§Ãµes laboratoriais significativas.\n\n";
}else{
laudo+="AlteraÃ§Ãµes detectadas:\n";
alteracoes.forEach(a=> laudo+="- "+a+"\n");
}

laudo+="\nÃndice InflamatÃ³rio: "+iriClass;
laudo+="\nScore Global de Gravidade: "+gravidade;

document.getElementById("relatorioAutomatico").value=laudo;
}

/* ================== RESIDENTES ================== */

function carregarResidentes(){
const banco = JSON.parse(localStorage.getItem("bancoILPI")) || {};
const select = document.getElementById("selectResidente");
select.innerHTML='<option value="">Selecionar residente...</option>';
Object.keys(banco).forEach(nome=>{
select.innerHTML+=`<option value="${nome}">${nome}</option>`;
});
}
carregarResidentes();

</script>
</body>
</html>
