<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exames Laboratoriais - ILPI</title>
<link rel="stylesheet" href="style.css">
</head>

<body onload="carregarResidentesExame()">

<!-- NAVBAR -->
<div class="navbar">
    <div class="nav-container">
        <img src="assets/logo.png" class="nav-logo" alt="Logo ILPI">

        <div class="nav-links">
            <a href="index.html" class="nav-link">ğŸ  Nova AvaliaÃ§Ã£o</a>
            <a href="dashboard.html" class="nav-link">ğŸ“Š Dashboard</a>
            <a href="ficha-completa.html" class="nav-link">ğŸ“‚ Ficha ClÃ­nica</a>
            <a href="exames-laboratoriais.html" class="nav-link home-btn">ğŸ§ª Exames</a>
            <a href="comorbidades.html" class="nav-link">ğŸ¥ Comorbidades</a>
            <a href="metodologia.html" class="nav-link">ğŸ“˜ Metodologia</a>
            <a href="relatorio-executivo.html" class="nav-link">ğŸ“‘ RelatÃ³rio</a>
        </div>
    </div>
</div>

<div class="container">

<header>
<h1>Registo de Exames Laboratoriais</h1>
<p>MonitorizaÃ§Ã£o bioquÃ­mica institucional</p>
</header>

<section>
<h3>IdentificaÃ§Ã£o</h3>
<div class="grid">
<select id="selectResidente">
<option value="">Selecionar residente...</option>
</select>

<input type="date" id="dataExame">
</div>
</section>

<section>
<h3>BioquÃ­mica BÃ¡sica</h3>
<div class="grid">
<input type="number" id="glicemia" placeholder="Glicemia (mg/dL)">
<input type="number" id="albumina" placeholder="Albumina (g/dL)">
<input type="number" id="hemoglobina" placeholder="Hemoglobina (g/dL)">
<input type="number" id="creatinina" placeholder="Creatinina (mg/dL)">
<input type="number" id="ureia" placeholder="Ureia (mg/dL)">
</div>
</section>

<section>
<h3>Perfil LipÃ­dico</h3>
<div class="grid">
<input type="number" id="colTotal" placeholder="Colesterol Total">
<input type="number" id="hdl" placeholder="HDL">
<input type="number" id="ldl" placeholder="LDL">
<input type="number" id="triglicerideos" placeholder="TriglicerÃ­deos">
</div>
</section>

<section>
<h3>Micronutrientes</h3>
<div class="grid">
<input type="number" id="vitD" placeholder="Vitamina D">
<input type="number" id="vitB12" placeholder="Vitamina B12">
<input type="number" id="ferro" placeholder="Ferro sÃ©rico">
<input type="number" id="ferritina" placeholder="Ferritina">
</div>
</section>

<div style="margin-top:30px;">
<button class="btn-save" onclick="salvarExames()">ğŸ’¾ Guardar Exames</button>
</div>

</div>

<script src="app.js"></script>

<script>

/* ============================= */
/* CARREGAR RESIDENTES */
/* ============================= */

function carregarResidentesExame() {

    const banco = obterBanco();
    const select = document.getElementById("selectResidente");

    select.innerHTML = '<option value="">Selecionar residente...</option>';

    const nomes = Object.keys(banco).sort();
    if (nomes.length === 0) return;

    nomes.forEach(nome => {
        select.innerHTML += `<option value="${nome}">${nome}</option>`;
    });
}

/* ============================= */
/* SALVAR EXAMES */
/* ============================= */

function salvarExames() {

    const nome = document.getElementById("selectResidente").value;
    const data = document.getElementById("dataExame").value;

    if (!nome || !data) {
        alert("Selecione residente e data.");
        return;
    }

    const banco = obterBanco();

    if (!banco[nome]) {
        banco[nome] = { avaliacoes: [], exames: [], comorbidades: [] };
    }

    if (!banco[nome].exames) {
        banco[nome].exames = [];
    }

    banco[nome].exames.push({
        data: data,
        glicemia: getNum("glicemia"),
        albumina: getNum("albumina"),
        hemoglobina: getNum("hemoglobina"),
        creatinina: getNum("creatinina"),
        ureia: getNum("ureia"),
        colTotal: getNum("colTotal"),
        hdl: getNum("hdl"),
        ldl: getNum("ldl"),
        triglicerideos: getNum("triglicerideos"),
        vitD: getNum("vitD"),
        vitB12: getNum("vitB12"),
        ferro: getNum("ferro"),
        ferritina: getNum("ferritina")
    });

    salvarBanco(banco);

    alert("Exames guardados com sucesso!");

    limparCampos();
}

/* ============================= */
/* LIMPAR FORMULÃRIO */
/* ============================= */

function limparCampos() {

    document.querySelectorAll("input[type='number']").forEach(input => {
        input.value = "";
    });

    document.getElementById("dataExame").value = "";
}

</script>

</body>
</html>
