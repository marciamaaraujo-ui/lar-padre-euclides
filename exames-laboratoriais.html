<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exames Laboratoriais - ILPI</title>
<link rel="stylesheet" href="style.css">

<style>
.tabela-exames {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 0.85rem;
}
.tabela-exames th,
.tabela-exames td {
    border: 1px solid #e0e0e0;
    padding: 8px;
    vertical-align: top;
}
.tabela-exames th {
    background: #f0f4f2;
    font-weight: bold;
}
.resultado-normal {
    background: #e8f8f5;
    color: #1e8449;
    font-weight: bold;
}
.resultado-alto {
    background: #fdecea;
    color: #c0392b;
    font-weight: bold;
}
.resultado-baixo {
    background: #fff4e6;
    color: #d35400;
    font-weight: bold;
}
textarea {
    width: 100%;
    margin-top: 25px;
    padding: 12px;
}
</style>
</head>

<body>

<div class="navbar">
<div class="nav-container">
<img src="assets/logo.png" class="nav-logo" alt="Logo ILPI">
<div class="nav-links">
<a href="index.html" class="nav-link">üè† Nova Avalia√ß√£o</a>
<a href="dashboard.html" class="nav-link">üìä Dashboard</a>
<a href="ficha-completa.html" class="nav-link">üìÇ Ficha Cl√≠nica</a>
<a href="exames-laboratoriais.html" class="nav-link home-btn">üß™ Exames</a>
<a href="comorbidades.html" class="nav-link">üè• Comorbidades</a>
<a href="metodologia.html" class="nav-link">üìò Metodologia</a>
</div>
</div>
</div>

<div class="container">

<h1>Painel Laboratorial Institucional</h1>

<table class="tabela-exames">
<thead>
<tr>
<th>Marcador</th>
<th>Resultado</th>
<th>Refer√™ncia</th>
<th>Altera√ß√£o</th>
<th>Interpreta√ß√£o Cl√≠nica</th>
</tr>
</thead>
<tbody id="corpoTabela"></tbody>
</table>

<h3>Relev√¢ncia Cl√≠nica e Nutricional Autom√°tica</h3>
<textarea id="relatorioAutomatico" rows="8"
placeholder="O parecer cl√≠nico ser√° gerado automaticamente conforme os resultados.">
</textarea>

</div>

<script>

const exames = [
{nome:"Hemoglobina", ref:[12,17.5], alto:"Policitemia ou desidrata√ß√£o.", baixo:"Anemia ou perda de sangue."},
{nome:"VCM", ref:[80,100], alto:"Anemia macroc√≠tica.", baixo:"Anemia microc√≠tica."},
{nome:"RDW", ref:[11.5,14.5], alto:"Anisocitose.", baixo:"Sem significado isolado."},
{nome:"Leuc√≥citos", ref:[4000,11000], alto:"Infec√ß√£o ou inflama√ß√£o.", baixo:"Imunossupress√£o."},
{nome:"Neutr√≥filos", ref:[45,70], alto:"Infec√ß√£o bacteriana.", baixo:"Risco infeccioso."},
{nome:"Eosin√≥filos", ref:[1,4], alto:"Alergias ou parasitoses.", baixo:"Estresse agudo."},
{nome:"Plaquetas", ref:[150000,450000], alto:"Inflama√ß√£o ou rea√ß√£o p√≥s-esplenectomia.", baixo:"Risco hemorr√°gico."},
{nome:"Glicemia Jejum", ref:[70,99], alto:"Hiperglicemia.", baixo:"Hipoglicemia."},
{nome:"HbA1c", ref:[0,5.7], alto:"Controle glic√™mico inadequado.", baixo:"Poss√≠vel interfer√™ncia hematol√≥gica."},
{nome:"Albumina", ref:[3.5,5.0], alto:"Desidrata√ß√£o.", baixo:"Desnutri√ß√£o ou inflama√ß√£o."},
{nome:"PCR", ref:[0,0.3], alto:"Inflama√ß√£o aguda.", baixo:"Normal."},
{nome:"Ureia", ref:[10,50], alto:"Insufici√™ncia renal ou dieta hiperproteica.", baixo:"Dieta hipoproteica ou doen√ßa hep√°tica."},
{nome:"Creatinina", ref:[0.6,1.3], alto:"Disfun√ß√£o renal.", baixo:"Baixa massa muscular (sarcopenia)."},
{nome:"Colesterol Total", ref:[0,190], alto:"Risco cardiovascular.", baixo:"M√° absor√ß√£o ou hipertireoidismo."},
{nome:"HDL", ref:[40,Infinity], alto:"Fator protetor cardiovascular.", baixo:"Risco cardiovascular aumentado."},
{nome:"LDL", ref:[0,130], alto:"Risco ateroscler√≥tico.", baixo:"Desnutri√ß√£o."},
{nome:"Triglicer√≠deos", ref:[0,150], alto:"Risco pancreatite.", baixo:"M√° absor√ß√£o."},
{nome:"Vitamina D", ref:[20,999], alto:"Toxicidade rara.", baixo:"Defici√™ncia √≥ssea."},
{nome:"Vitamina B12", ref:[200,900], alto:"Suplementa√ß√£o excessiva.", baixo:"Defici√™ncia comum."},
{nome:"Ferritina", ref:[13,400], alto:"Prote√≠na de fase aguda (inflama√ß√£o).", baixo:"Defici√™ncia de ferro."},
{nome:"Ferro S√©rico", ref:[60,170], alto:"Sobrecarga de ferro.", baixo:"Anemia ferropriva."},
{nome:"Zinco", ref:[70,120], alto:"Suplementa√ß√£o excessiva.", baixo:"Baixa imunidade e cicatriza√ß√£o prejudicada."},
{nome:"Pot√°ssio", ref:[3.5,5.1], alto:"Risco card√≠aco.", baixo:"Uso de diur√©ticos ou perdas gastrointestinais."},
{nome:"C√°lcio", ref:[8.5,10.2], alto:"Hiperparatireoidismo.", baixo:"Defici√™ncia de vitamina D."},
{nome:"TGO/TGP", ref:[0,40], alto:"Les√£o hep√°tica ou muscular.", baixo:"Sem significado cl√≠nico relevante."},
{nome:"TSH", ref:[0.45,4.5], alto:"Hipotireoidismo.", baixo:"Hipertireoidismo."}
];

const tbody = document.getElementById("corpoTabela");

exames.forEach((ex,i)=>{
tbody.innerHTML += `
<tr>
<td>${ex.nome}</td>
<td><input type="number" step="any" id="res_${i}" oninput="analisarLinha(${i})"></td>
<td>${ex.ref[0]} - ${ex.ref[1]}</td>
<td id="status_${i}">-</td>
<td id="interp_${i}">-</td>
</tr>`;
});

function analisarLinha(i){
const ex = exames[i];
const val = parseFloat(document.getElementById("res_"+i).value);
const status = document.getElementById("status_"+i);
const interp = document.getElementById("interp_"+i);

if(isNaN(val)){
status.innerText="-";
interp.innerText="-";
status.className="";
gerarRelatorioAutomatico();
return;
}

if(val > ex.ref[1]){
status.innerText="‚Üë";
status.className="resultado-alto";
interp.innerText=ex.alto;
}
else if(val < ex.ref[0]){
status.innerText="‚Üì";
status.className="resultado-baixo";
interp.innerText=ex.baixo;
}
else{
status.innerText="Normal";
status.className="resultado-normal";
interp.innerText="Dentro da normalidade.";
}

gerarRelatorioAutomatico();
}

function gerarRelatorioAutomatico(){

let r = {};
let alteracoes = 0;

exames.forEach((ex,i)=>{
let status = document.getElementById("status_"+i).innerText;
if(status==="‚Üë" || status==="‚Üì"){
r[ex.nome] = status;
alteracoes++;
}
});

let texto = "";
let sistemas = 0;
let iri = 0;

/* ===== √çNDICE INFLAMAT√ìRIO ===== */
if(r["PCR"]==="‚Üë"){ iri+=2; }
if(r["Ferritina"]==="‚Üë"){ iri+=1; }
if(r["Neutr√≥filos"]==="‚Üë"){ iri+=1; }
if(r["Albumina"]==="‚Üì"){ iri+=1; }
if(r["Plaquetas"]==="‚Üë"){ iri+=1; }

let iriClass = "Baixo";
if(iri>=4) iriClass="Alto";
else if(iri>=2) iriClass="Moderado";

/* ===== HEMATOL√ìGICO ===== */
let anemia = false;

if(r["Hemoglobina"]==="‚Üì" && r["Ferro S√©rico"]==="‚Üì"){
texto += "Anemia ferropriva estabelecida.\n\n";
anemia = true;
sistemas++;
}

/* ===== INFLAMAT√ìRIO ===== */
if(r["PCR"]==="‚Üë" && r["Neutr√≥filos"]==="‚Üë"){
texto += "Processo infeccioso bacteriano prov√°vel.\n\n";
sistemas++;
}

if(r["PCR"]==="‚Üë" && r["Albumina"]==="‚Üì"){
texto += "Inflama√ß√£o sist√™mica com repercuss√£o nutricional.\n\n";
sistemas++;
}

/* ===== RENAL ===== */
if(r["Ureia"]==="‚Üë" && r["Creatinina"]==="‚Üë"){
texto += "Comprometimento da fun√ß√£o renal.\n\n";
sistemas++;
}

/* ===== NUTRICIONAL ===== */
if(r["Albumina"]==="‚Üì"){
texto += "Risco de desnutri√ß√£o proteico-cal√≥rica.\n\n";
sistemas++;
}

if(texto===""){
texto="Altera√ß√µes isoladas sem padr√£o fisiopatol√≥gico cruzado relevante.\n\n";
}

/* ===== SCORE GLOBAL ===== */
let gravidade="Baixa";
if(sistemas>=2 || alteracoes>=5){ gravidade="Moderada"; }
if(iri>=4 || sistemas>=3){ gravidade="Alta"; }

/* ===== PES ACUMULATIVO ===== */
let pesList = [];

if(r["Albumina"]==="‚Üì"){
pesList.push("Desnutri√ß√£o proteico-cal√≥rica relacionada a processo inflamat√≥rio evidenciada por hipoalbuminemia.");
}

if(anemia){
pesList.push("Anemia relacionada √† defici√™ncia de micronutrientes evidenciada por hemoglobina reduzida.");
}

if(r["Glicemia Jejum"]==="‚Üë"){
pesList.push("Descontrole glic√™mico relacionado √† resist√™ncia insul√≠nica evidenciado por hiperglicemia.");
}

let pes = pesList.length > 0 
? pesList.join("\n\n") 
: "Sem diagn√≥stico nutricional laboratorial estabelecido.";

/* ===== LAUDO FINAL ===== */
let laudo = "LAUDO CL√çNICO NUTRICIONAL\n\n";
laudo += "1. An√°lise Laboratorial Integrada:\n";
laudo += texto + "\n";
laudo += "2. √çndice de Risco Inflamat√≥rio: " + iriClass + " (Score: "+iri+")\n\n";
laudo += "3. Score Global de Gravidade: " + gravidade + "\n\n";
laudo += "4. Diagn√≥stico Nutricional (PES):\n" + pes + "\n\n";
laudo += "5. Recomenda√ß√µes:\n";

if(gravidade==="Alta"){
laudo += "- Monitoriza√ß√£o cl√≠nica intensiva.\n- Reavalia√ß√£o laboratorial em curto prazo.\n";
}
else if(gravidade==="Moderada"){
laudo += "- Ajustes nutricionais direcionados.\n";
}
else{
laudo += "- Manuten√ß√£o e acompanhamento peri√≥dico.\n";
}

document.getElementById("relatorioAutomatico").value = laudo;

}

</script>

</body>
</html>
