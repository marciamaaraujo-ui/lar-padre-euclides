<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avaliação Nutricional Completa - ILPI</title>
<link rel="stylesheet" href="style.css">

<style>
.container{max-width:1000px;margin:auto;padding:20px;}
.secao{
background:#f9fbfa;
padding:25px;
border-radius:10px;
margin-bottom:35px;
border:1px solid #e0e0e0;
}
.form-group{
display:flex;
flex-direction:column;
margin-bottom:18px;
}
label{
font-weight:600;
margin-bottom:6px;
}
input, select{
padding:8px;
font-size:0.9rem;
border:1px solid #ccc;
border-radius:6px;
}
textarea{
width:100%;
padding:12px;
font-size:0.9rem;
border-radius:6px;
margin-top:20px;
}
.botao{
margin-top:15px;
padding:10px 20px;
background:#2c7a7b;
color:white;
border:none;
border-radius:6px;
cursor:pointer;
}
.botao:hover{
background:#285e61;
}
.alerta-alto{
border:6px solid red !important;
}
</style>
</head>

<body>

<div class="container">

<h1>Avaliação Nutricional Completa</h1>

<div class="secao">
<h2>Dados Gerais</h2>

<div class="form-group">
<label>Nome do Residente</label>
<input type="text" id="nome">
</div>

<div class="form-group">
<label>Sexo</label>
<select id="sexo" onchange="calcularTudo()">
<option value="">Selecionar</option>
<option value="F">Feminino</option>
<option value="M">Masculino</option>
</select>
</div>

<div class="form-group">
<label>Data de Admissão</label>
<input type="date" id="dataAdmissao">
</div>
</div>

<div class="secao">
<h2>Antropometria</h2>

<div class="form-group">
<label>Peso (kg)</label>
<input type="number" id="peso" step="any" oninput="calcularTudo()">
</div>

<div class="form-group">
<label>Altura (m)</label>
<input type="number" id="altura" step="any" oninput="calcularTudo()">
</div>

<div class="form-group">
<label>IMC (kg/m²)</label>
<input type="text" id="imc" readonly>
</div>

<div class="form-group">
<label>Classificação IMC (Lipschitz 1994)</label>
<input type="text" id="classImc" readonly>
</div>

<div class="form-group">
<label>Circunferência do Braço (cm)</label>
<input type="number" id="cb" step="any" oninput="calcularTudo()">
</div>

<div class="form-group">
<label>Adequação CB (%)</label>
<input type="text" id="adequacaoCB" readonly>
</div>

<div class="form-group">
<label>Classificação CB</label>
<input type="text" id="classCB" readonly>
</div>

<div class="form-group">
<label>Circunferência da Panturrilha (cm)</label>
<input type="number" id="cp" step="any" oninput="calcularTudo()">
</div>

<div class="form-group">
<label>Classificação CP (ajustada pelo IMC)</label>
<input type="text" id="classCP" readonly>
</div>

</div>

<div class="secao">
<h2>Marcadores Inflamatórios</h2>

<div class="form-group">
<label>Albumina (g/dL)</label>
<input type="number" id="albumina" step="any" oninput="calcularTudo()">
</div>

<div class="form-group">
<label>PCR (mg/dL)</label>
<input type="number" id="pcr" step="any" oninput="calcularTudo()">
</div>
</div>

<h2>Relatório Nutricional Institucional</h2>
<textarea id="relatorioAutomatico" rows="16"></textarea>

<button class="botao" onclick="gerarPDF()">Gerar PDF Institucional</button>

</div>

<script>

function calcularTudo(){

document.body.classList.remove("alerta-alto");

let peso=parseFloat(document.getElementById("peso").value);
let altura=parseFloat(document.getElementById("altura").value);
let sexo=document.getElementById("sexo").value;
let cb=parseFloat(document.getElementById("cb").value);
let cp=parseFloat(document.getElementById("cp").value);
let albumina=parseFloat(document.getElementById("albumina").value);
let pcr=parseFloat(document.getElementById("pcr").value);

let imc=null;
let classIMC="-";
let classCB="-";
let classCP="-";
let adequacaoCB=null;
let sarcScore=0;
let inflamacao=false;

/* ===== IMC ===== */

if(!isNaN(peso) && !isNaN(altura) && altura>0){

imc=(peso/(altura*altura));
document.getElementById("imc").value=imc.toFixed(2);

if(imc<22){
classIMC="Baixo Peso (Desnutrição)";
sarcScore+=1;
}
else if(imc<=27){
classIMC="Eutrofia";
}
else{
classIMC="Sobrepeso";
}

document.getElementById("classImc").value=classIMC;

}else{
document.getElementById("imc").value="";
document.getElementById("classImc").value="";
}

/* ===== CB ===== */

if(!isNaN(cb) && sexo){

let referencia= sexo==="F" ? 28 : 29;
adequacaoCB=(cb/referencia)*100;

document.getElementById("adequacaoCB").value=adequacaoCB.toFixed(1)+" %";

if(adequacaoCB<80){
classCB="Desnutrição Grave";
sarcScore+=2;
}
else if(adequacaoCB<90){
classCB="Desnutrição Moderada";
sarcScore+=1;
}
else if(adequacaoCB<100){
classCB="Desnutrição Leve";
}
else{
classCB="Adequado";
}

document.getElementById("classCB").value=classCB;

}else{
document.getElementById("adequacaoCB").value="";
document.getElementById("classCB").value="";
}

/* ===== CP AJUSTADA ===== */

let corteAjustado=null;

if(!isNaN(cp) && imc!==null && sexo){

let corteBase= sexo==="F" ? 33 : 34;
let ajuste=0;

if(imc>=25 && imc<30) ajuste=3;
if(imc>=30 && imc<40) ajuste=7;
if(imc>=40) ajuste=12;

corteAjustado=corteBase-ajuste;

if(cp<corteAjustado){
classCP="Risco de Baixa Massa Muscular";
sarcScore+=2;
}
else{
classCP="Adequado";
}

document.getElementById("classCP").value=classCP;

}else{
document.getElementById("classCP").value="";
}

/* ===== INFLAMAÇÃO ===== */

if(!isNaN(albumina) && albumina<3.5){
inflamacao=true;
sarcScore+=1;
}

if(!isNaN(pcr) && pcr>0.3){
inflamacao=true;
sarcScore+=1;
}

/* ===== CLASSIFICAÇÃO FINAL ===== */

let risco="Baixo";

if(sarcScore>=5){
risco="Alto";
document.body.classList.add("alerta-alto");
}
else if(sarcScore>=3){
risco="Moderado";
}

/* ===== DIAGNÓSTICO ===== */

let diagnostico="";

if(risco==="Alto" && inflamacao){
diagnostico="Desnutrição proteico-calórica grave associada a inflamação sistêmica ativa e sarcopenia estabelecida.";
}
else if(risco==="Alto"){
diagnostico="Sarcopenia estabelecida com perda significativa de massa muscular.";
}
else if(risco==="Moderado"){
diagnostico="Risco de sarcopenia com possível comprometimento nutricional.";
}
else{
diagnostico="Sem evidências clínicas relevantes de sarcopenia.";
}

/* ===== RELATÓRIO ===== */

let relatorio=`
RELATÓRIO NUTRICIONAL INSTITUCIONAL

Nome: ${document.getElementById("nome").value || "-"}
Data de Admissão: ${document.getElementById("dataAdmissao").value || "-"}

IMC: ${imc?imc.toFixed(2):"-"} (${classIMC})
Circunferência do Braço: ${classCB} ${adequacaoCB?`(${adequacaoCB.toFixed(1)} %)`:""}
Circunferência da Panturrilha: ${classCP} ${corteAjustado?`(Corte ajustado: ${corteAjustado} cm)`:""}

Albumina: ${albumina||"-"}
PCR: ${pcr||"-"}

Score Numérico de Sarcopenia: ${sarcScore}
Classificação Final: ${risco}

Diagnóstico Nutricional:
${diagnostico}
`;

document.getElementById("relatorioAutomatico").value=relatorio;

}

/* ===== PDF ===== */

function gerarPDF(){

let conteudo=document.getElementById("relatorioAutomatico").value;

let win=window.open('');
win.document.write(`
<html>
<head>
<title>Relatório Nutricional</title>
<style>
body{font-family:Arial;padding:40px;}
h1{color:#2c7a7b;}
</style>
</head>
<body>
<h1>Relatório Nutricional Institucional</h1>
<pre>${conteudo}</pre>
</body>
</html>
`);
win.print();
win.close();

}

</script>

</body>
</html>
