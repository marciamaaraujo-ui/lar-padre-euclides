<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relat√≥rio Executivo - ILPI</title>
<link rel="stylesheet" href="style.css">

<style>
.chart-container { margin-top: 30px; }

.bar-wrap {
    background: #eee;
    border-radius: 10px;
    height: 25px;
    margin-bottom: 20px;
    overflow: hidden;
    position: relative;
}

.bar-fill {
    height: 100%;
    transition: width 1s ease-in-out;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    color: white;
    font-size: 0.8rem;
    font-weight: bold;
}

.label-group {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 0.9rem;
}

@media print {
    .no-print { display: none !important; }
}
</style>
</head>

<body onload="gerarRelatorioExecutivo()">

<!-- NAVBAR INSTITUCIONAL -->
<div class="navbar">
  <div class="nav-container">
    <div class="nav-left">
      <img src="assets/logo.png" alt="Logo ILPI" class="nav-logo">
      <span class="nav-title">Sistema Nutricional ILPI</span>
    </div>

    <div class="nav-links">
      <a href="index.html">üè† In√≠cio</a>
      <a href="ficha-completa.html">üìã Avalia√ß√£o</a>
      <a href="exames-laboratoriais.html">üß™ Exames</a>
      <a href="comorbidades.html">üè• Comorbidades</a>
      <a href="dashboard.html">üìä Dashboard</a>
      <a href="metodologia.html">üìò Metodologia</a>
    </div>
  </div>
</div>

<div class="container">
    
<header style="display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid var(--primary-color); padding-bottom:20px; margin-bottom:40px;">
    <div>
        <h1 style="margin:0;">Relat√≥rio Executivo Nutricional</h1>
        <p style="margin:5px 0 0 0;">An√°lise Global da Popula√ß√£o Institucionalizada</p>
    </div>
    <button class="btn-save no-print"
            onclick="window.print()"
            style="width:auto; padding:10px 20px; font-size:0.9rem; background:var(--secondary-color);">
        üñ®Ô∏è Imprimir Relat√≥rio
    </button>
</header>

<!-- CARDS -->
<div class="grid">
    <div class="stat-card">
        <label>Popula√ß√£o Avaliada</label>
        <p id="totalResidentes">0</p>
    </div>

    <div class="stat-card">
        <label>Alto Risco Cl√≠nico</label>
        <p id="totalAltoRisco" style="color:#e74c3c;">0</p>
    </div>

    <div class="stat-card">
        <label>Risco Moderado</label>
        <p id="totalModerado" style="color:#f39c12;">0</p>
    </div>
</div>

<!-- DISTRIBUI√á√ÉO ICN -->
<section style="margin-top:40px;">
<h3>Distribui√ß√£o de Risco (ICN %)</h3>

<div class="chart-container">

<div class="label-group">
<span>Baixo Risco</span>
<span id="percBaixo">0%</span>
</div>
<div class="bar-wrap">
<div id="barBaixo" class="bar-fill" style="background:#27ae60; width:0%;"></div>
</div>

<div class="label-group">
<span>Risco Moderado</span>
<span id="percModerado">0%</span>
</div>
<div class="bar-wrap">
<div id="barModerado" class="bar-fill" style="background:#f39c12; width:0%;"></div>
</div>

<div class="label-group">
<span>Alto Risco Cl√≠nico</span>
<span id="percAlto">0%</span>
</div>
<div class="bar-wrap">
<div id="barAlto" class="bar-fill" style="background:#e74c3c; width:0%;"></div>
</div>

</div>
</section>

<!-- TABELA IMC -->
<section style="margin-top:40px;">
<h3>Distribui√ß√£o do Estado Nutricional (IMC)</h3>

<table>
<thead>
<tr>
<th>Classifica√ß√£o</th>
<th>N¬∫ Residentes</th>
<th>%</th>
</tr>
</thead>

<tbody id="tabelaIMC"></tbody>
</table>

</section>

<footer style="margin-top:50px; text-align:center; font-size:0.8rem; color:#999;">
Relat√≥rio gerado automaticamente em
<span id="dataAtual"></span>
</footer>

</div>

<script src="app.js"></script>

<script>

function gerarRelatorioExecutivo() {

    const banco = obterBanco();
    const nomes = Object.keys(banco);

    let totalValidos = 0;
    let icnCounts = { baixo: 0, moderado: 0, alto: 0 };
    let imcCounts = { baixo: 0, eutrofia: 0, excesso: 0 };

    nomes.forEach(nome => {

        if (!banco[nome].avaliacoes || banco[nome].avaliacoes.length === 0) return;

        totalValidos++;

        const ultima = banco[nome].avaliacoes.slice(-1)[0];

        const risco = ultima.classificacaoICN;

        if (risco === "Baixo Risco") icnCounts.baixo++;
        else if (risco === "Risco Moderado") icnCounts.moderado++;
        else if (risco === "Alto Risco Cl√≠nico") icnCounts.alto++;

        const imcVal = parseFloat(ultima.imc);

        if (!isNaN(imcVal)) {
            if (imcVal < 22) imcCounts.baixo++;
            else if (imcVal <= 27) imcCounts.eutrofia++;
            else imcCounts.excesso++;
        }
    });

    document.getElementById("dataAtual").innerText =
        new Date().toLocaleDateString("pt-BR");

    document.getElementById("totalResidentes").innerText = totalValidos;
    document.getElementById("totalAltoRisco").innerText = icnCounts.alto;
    document.getElementById("totalModerado").innerText = icnCounts.moderado;

    function atualizarBarra(idPerc, idBar, valor) {

        const perc = totalValidos > 0 ? (valor / totalValidos) * 100 : 0;
        const percFormatado = perc.toFixed(1);

        document.getElementById(idPerc).innerText = percFormatado + "%";
        document.getElementById(idBar).style.width = percFormatado + "%";
    }

    atualizarBarra("percBaixo", "barBaixo", icnCounts.baixo);
    atualizarBarra("percModerado", "barModerado", icnCounts.moderado);
    atualizarBarra("percAlto", "barAlto", icnCounts.alto);

    const tabela = document.getElementById("tabelaIMC");

    const dadosIMC = [
        { label: "IMC < 22 (Baixo Peso)", qtd: imcCounts.baixo },
        { label: "IMC 22‚Äì27 (Eutrofia)", qtd: imcCounts.eutrofia },
        { label: "IMC > 27 (Excesso de Peso)", qtd: imcCounts.excesso }
    ];

    tabela.innerHTML = dadosIMC.map(item => {

        const perc = totalValidos > 0
            ? ((item.qtd / totalValidos) * 100).toFixed(1)
            : "0.0";

        return `
            <tr>
                <td>${item.label}</td>
                <td>${item.qtd}</td>
                <td><strong>${perc}%</strong></td>
            </tr>
        `;
    }).join('');
}

</script>

</body>
</html>
